const express = require('express')
const bodyParser = require('body-parser')

const app = express()
const port = 8081

app.use(bodyParser.urlencoded({ extended: true }))
app.use(bodyParser.json())

const withoutGroup = [{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":43.45783586555653,"edata_type":"enrol"}}]
const stateGroup = [{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":29.207281349756634,"edata_type":"enrol","state":"Uttar Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":4.003911343725148,"edata_type":"enrol","state":"Andhra Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":4.003911343725148,"edata_type":"enrol","state":"Karnataka"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"edata_type":"enrol","state":"Tamil Nadu"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"edata_type":"enrol","state":null}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"edata_type":"enrol","state":"Andaman & Nicobar Islands"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"edata_type":"enrol","state":"Arunachal Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"edata_type":"enrol","state":"Maharashtra"}}]
const districtGroup = [{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":20.098296726168925,"district":"AGRA","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":7.011990219885757,"district":"ALIGARH","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"ANANTAPUR","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"Ariyalur","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"BENGALURU URBAN SOUTH","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":null,"edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"AMBEDKAR NAGAR","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"ANJAW","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Anakapalli","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Anantapur","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Andamans","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"BAREILLY","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"BENGALURU RURAL","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Bengaluru Rural","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"GHAZIABAD","edata_type":"enrol"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"PUNE","edata_type":"enrol"}}]
const stateDistGroup = [{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":20.098296726168925,"district":"AGRA","edata_type":"enrol","state":"Uttar Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":7.011990219885757,"district":"ALIGARH","edata_type":"enrol","state":"Uttar Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"ANANTAPUR","edata_type":"enrol","state":"Andhra Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"BENGALURU URBAN SOUTH","edata_type":"enrol","state":"Karnataka"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":2.000977198748901,"district":"Ariyalur","edata_type":"enrol","state":"Tamil Nadu"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":null,"edata_type":"enrol","state":null}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Andamans","edata_type":"enrol","state":"Andaman & Nicobar Islands"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Anakapalli","edata_type":"enrol","state":"Andhra Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Anantapur","edata_type":"enrol","state":"Andhra Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"ANJAW","edata_type":"enrol","state":"Arunachal Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"BENGALURU RURAL","edata_type":"enrol","state":"Karnataka"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"Bengaluru Rural","edata_type":"enrol","state":"Karnataka"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"PUNE","edata_type":"enrol","state":"Maharashtra"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"AMBEDKAR NAGAR","edata_type":"enrol","state":"Uttar Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"BAREILLY","edata_type":"enrol","state":"Uttar Pradesh"}},{"version":"v1","timestamp":"2020-01-01T00:00:00.000Z","event":{"userCount":1.0002442201269182,"district":"GHAZIABAD","edata_type":"enrol","state":"Uttar Pradesh"}}]

app.post('/druid/v2/', (req, res) => {
  let dimensionBody = JSON.stringify(req.body.dimensions)
  let response = '{}'
  if (dimensionBody.includes("derived_loc_state") && dimensionBody.includes("derived_loc_district")){
    response = stateDistGroup
  } else if (dimensionBody.includes("derived_loc_state")) {
    response = stateGroup
  } else if (dimensionBody.includes("derived_loc_district")) {
    response = districtGroup
  } else {
    response = withoutGroup
  }
  res.send(response)
})

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`)
})